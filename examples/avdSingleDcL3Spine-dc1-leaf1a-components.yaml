# TODO: separate FABRIC from SERVICEs (user vlan's and vrf's)
#
apiVersion: eos.netclab.dev/v1alpha1
kind: VlanInternalAllocation
metadata:
  name: dc1-leaf1a-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  order: ascending
  range:
    start: 1006
    end: 1199
---
apiVersion: eos.netclab.dev/v1alpha1
kind: StpMode
metadata:
  name: dc1-leaf1a-2-0
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  stpMode: mstp
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    # spanning-tree mode mstp: {} # default; isRemovedCheck fails
    no spanning-tree vlan-id 4093-4094: {}
    spanning-tree mst 0 priority 4096: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-3-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  removeContainer: true
  cmds:
    vlan 11:
      name VRF10_VLAN11: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-3-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  removeContainer: true
  cmds:
    vlan 12:
      name VRF10_VLAN12: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-3-3
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  removeContainer: true
  cmds:
    vlan 21:
      name VRF11_VLAN21: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-3-4
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  removeContainer: true
  cmds:
    vlan 22:
      name VRF11_VLAN22: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-3-5
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  removeContainer: true
  cmds:
    vlan 3009:
      name MLAG_L3_VRF_VRF10: {}
      trunk group MLAG: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-3-6
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  removeContainer: true
  cmds:
    vlan 3010:
      name MLAG_L3_VRF_VRF11: {}
      trunk group MLAG: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-3-7
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  removeContainer: true
  cmds:
    vlan 3401:
      name L2_VLAN3401: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-3-8
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  removeContainer: true
  cmds:
    vlan 3402:
      name L2_VLAN3402: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-3-9
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  removeContainer: true
  cmds:
    vlan 4093:
      name MLAG_L3: {}
      trunk group MLAG: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-3-10
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  removeContainer: true
  cmds:
    vlan 4094:
      name MLAG: {}
      trunk group MLAG: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-4-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    vrf instance VRF10: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-4-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    vrf instance VRF11: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-5-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Port-Channel3:
      description MLAG_dc1-leaf1b_Port-Channel3: {}
      # no shutdown: {}
      switchport mode trunk: {}
      switchport trunk group MLAG: {}
      # switchport: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-5-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Port-Channel5:
      description SERVER_dc1-leaf1-server1_Bond1: {}
      # no shutdown: {}
      switchport trunk native vlan 4092: {}
      switchport trunk allowed vlan 11-12,21-22: {}
      switchport mode trunk: {}
      # switchport: {}
      mlag 5: {}
      spanning-tree portfast edge: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-5-3
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Port-Channel8:
      description L2_dc1-leaf1c_Port-Channel1: {}
      # no shutdown: {}
      switchport trunk allowed vlan 11-12,21-22,3401-3402: {}
      switchport mode trunk: {}
      # switchport: {}
      mlag 8: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: RoutedInterface
metadata:
  name: dc1-leaf1a-6-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  ifName: Ethernet1
  ipv4Address: 10.255.255.1
  ipv4PrefixLength: 31
---
apiVersion: eos.netclab.dev/v1alpha1
kind: RoutedInterface
metadata:
  name: dc1-leaf1a-6-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  ifName: Ethernet2
  ipv4Address: 10.255.255.3
  ipv4PrefixLength: 31
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-7-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Ethernet3:
      description MLAG_dc1-leaf1b_Ethernet3: {}
      # no shutdown: {}
      channel-group 3 mode active: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-7-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Ethernet4:
      description MLAG_dc1-leaf1b_Ethernet4: {}
      # no shutdown: {}
      channel-group 3 mode active: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-8
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Ethernet5:
      description SERVER_dc1-leaf1-server1_PCI1: {}
      # no shutdown: {}
      channel-group 5 mode active: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-9
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Ethernet8:
      description L2_dc1-leaf1c_Ethernet1: {}
      # no shutdown: {}
      channel-group 8 mode active: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-10-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Loopback0:
      description ROUTER_ID: {}
      # no shutdown: {}
      ip address 10.255.0.3/32: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-10-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Loopback1:
      description VXLAN_TUNNEL_SOURCE: {}
      # no shutdown: {}
      ip address 10.255.1.3/32: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-11-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Loopback10:
      description DIAG_VRF_VRF10: {}
      # no shutdown: {}
      vrf VRF10: {}
      ip address 10.255.10.3/32: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-11-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Loopback11:
      description DIAG_VRF_VRF11: {}
      # no shutdown: {}
      vrf VRF11: {}
      ip address 10.255.11.3/32: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-12-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Vlan11:
      description VRF10_VLAN11: {}
      # no shutdown: {}
      vrf VRF10: {}
      ip address virtual 10.10.11.1/24: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-12-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Vlan12:
      description VRF10_VLAN12: {}
      # no shutdown: {}
      vrf VRF10: {}
      ip address virtual 10.10.12.1/24: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-12-3
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Vlan21:
      description VRF11_VLAN21: {}
      # no shutdown: {}
      vrf VRF11: {}
      ip address virtual 10.10.21.1/24: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-12-4
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Vlan22:
      description VRF11_VLAN22: {}
      # no shutdown: {}
      vrf VRF11: {}
      ip address virtual 10.10.22.1/24: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-13-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Vlan3009:
      description MLAG_L3_VRF_VRF10: {}
      # no shutdown: {}
      mtu 1500: {}
      vrf VRF10: {}
      ip address 10.255.1.96/31: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-13-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Vlan3010:
      description MLAG_L3_VRF_VRF11: {}
      # no shutdown: {}
      mtu 1500: {}
      vrf VRF11: {}
      ip address 10.255.1.96/31: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-14
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Vlan4093:
      description MLAG_L3: {}
      # no shutdown: {}
      mtu 1500: {}
      ip address 10.255.1.96/31: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-15
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    interface Vlan4094:
      description MLAG: {}
      # no shutdown: {}
      mtu 1500: {}
      no autostate: {}
      ip address 10.255.1.64/31: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-16
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  removeContainer: true
  cmds:
    interface Vxlan1:
      description dc1-leaf1a_VTEP: {}
      vxlan source-interface Loopback1: {}
      vxlan virtual-router encapsulation mac-address mlag-system-id: {}
      vxlan udp-port 4789: {}
      vxlan vlan 11 vni 10011: {}
      vxlan vlan 12 vni 10012: {}
      vxlan vlan 21 vni 10021: {}
      vxlan vlan 22 vni 10022: {}
      vxlan vlan 3401 vni 13401: {}
      vxlan vlan 3402 vni 13402: {}
      vxlan vrf VRF10 vni 10: {}
      vxlan vrf VRF11 vni 11: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-17
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    ip virtual-router mac-address 00:1c:73:00:00:99: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-18-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    ip address virtual source-nat vrf VRF10 address 10.255.10.3: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-18-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    ip address virtual source-nat vrf VRF11 address 10.255.11.3: {}
#
#
#
#
---
apiVersion: eos.netclab.dev/v1alpha1
kind: IpRouting
metadata:
  name: dc1-leaf1a-19-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-19-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    ip routing vrf VRF10: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-19-3
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    ip routing vrf VRF11: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-20
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    mlag configuration:
      domain-id DC1_L3_LEAF1: {}
      local-interface Vlan4094: {}
      peer-address 10.255.1.65: {}
      peer-link Port-Channel3: {}
      reload-delay mlag 300: {}
      reload-delay non-mlag 330: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-21-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY:
      seq 10 permit 10.255.0.0/27 eq 32: {}
      seq 20 permit 10.255.1.0/27 eq 32: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-21-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    route-map RM-CONN-2-BGP permit 10:
      match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-22-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    ip prefix-list PL-MLAG-PEER-VRFS:
      seq 10 permit 10.255.1.96/31: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-22-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    route-map RM-CONN-2-BGP-VRFS deny 10:
      match ip address prefix-list PL-MLAG-PEER-VRFS: {}
    route-map RM-CONN-2-BGP-VRFS permit 20: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-23
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    route-map RM-MLAG-PEER-IN permit 10:
      description Make routes learned over MLAG Peer-link less preferred on spines to ensure optimal routing: {}
      set origin incomplete: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: BfdMultihopGlobal
metadata:
  name: dc1-leaf1a-24
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  interval: 300
  minRx: 300
  multiplier: 3
  crossplane:
    compositionRef:
      name: bfdmultihopglobals.eapi.eos.netclab.dev
---
apiVersion: eos.netclab.dev/v1alpha1
kind: BgpGlobal
metadata:
  name: dc1-leaf1a-25
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  asn: 65101
  routerId: 10.255.0.3
  disableBgpDefaultIpv4Unicast: true
  maximumPaths:
    number: 4
    ecmp: 4
---
apiVersion: eos.netclab.dev/v1alpha1
kind: BgpPeerGroup
metadata:
  name: dc1-leaf1a-26
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  peerGroupName: EVPN-OVERLAY-PEERS
  updateSource: Loopback0
  bfd: true
  ebgpMultihop: 3
  sendCommunityTypes:
  - EXTENDED
  - STANDARD
  maximumRoutes: 0
---
apiVersion: eos.netclab.dev/v1alpha1
kind: BgpPeerGroup
metadata:
  name: dc1-leaf1a-27
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  peerGroupName: IPv4-UNDERLAY-PEERS
  sendCommunityTypes:
  - EXTENDED
  - STANDARD
  maximumRoutes: 12000
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-28
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    router bgp 65101:
      neighbor MLAG-IPv4-UNDERLAY-PEER peer group: {}
      neighbor MLAG-IPv4-UNDERLAY-PEER remote-as 65101: {}
      neighbor MLAG-IPv4-UNDERLAY-PEER next-hop-self: {}
      neighbor MLAG-IPv4-UNDERLAY-PEER description dc1-leaf1b: {}
      neighbor MLAG-IPv4-UNDERLAY-PEER route-map RM-MLAG-PEER-IN in: {}
      neighbor MLAG-IPv4-UNDERLAY-PEER password 7 4b21pAdCvWeAqpcKDFMdWw==: {}
      neighbor MLAG-IPv4-UNDERLAY-PEER send-community: {}
      neighbor MLAG-IPv4-UNDERLAY-PEER maximum-routes 12000: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: BgpNeighbor
metadata:
  name: dc1-leaf1a-29-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  asn: 65101
  neighborIp: 10.255.0.1
  neighborAsn: 65100
  peerGroup: EVPN-OVERLAY-PEERS
  crossplane:
    compositionRef:
      name: bgpneighbors.eapi.eos.netclab.dev
---
apiVersion: eos.netclab.dev/v1alpha1
kind: BgpNeighbor
metadata:
  name: dc1-leaf1a-29-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  asn: 65101
  neighborIp: 10.255.0.2
  neighborAsn: 65100
  peerGroup: EVPN-OVERLAY-PEERS
  crossplane:
    compositionRef:
      name: bgpneighbors.eapi.eos.netclab.dev
---
apiVersion: eos.netclab.dev/v1alpha1
kind: BgpNeighbor
metadata:
  name: dc1-leaf1a-30-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  asn: 65101
  neighborIp: 10.255.255.0
  neighborAsn: 65100
  peerGroup: IPv4-UNDERLAY-PEERS
  crossplane:
    compositionRef:
      name: bgpneighbors.eapi.eos.netclab.dev
---
apiVersion: eos.netclab.dev/v1alpha1
kind: BgpNeighbor
metadata:
  name: dc1-leaf1a-30-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  asn: 65101
  neighborIp: 10.255.255.2
  neighborAsn: 65100
  peerGroup: IPv4-UNDERLAY-PEERS
  crossplane:
    compositionRef:
      name: bgpneighbors.eapi.eos.netclab.dev
---
apiVersion: eos.netclab.dev/v1alpha1
kind: BgpNeighbor
metadata:
  name: dc1-leaf1a-31
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  asn: 65101
  neighborIp: 10.255.1.97
  peerGroup: MLAG-IPv4-UNDERLAY-PEER
  crossplane:
    compositionRef:
      name: bgpneighbors.eapi.eos.netclab.dev
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-32
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    router bgp 65101:
      redistribute connected route-map RM-CONN-2-BGP: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-33-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    router bgp 65101:
      vlan 11:
        rd 10.255.0.3:10011: {}
        route-target both 10011:10011: {}
        redistribute learned: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-33-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    router bgp 65101:
      vlan 12:
        rd 10.255.0.3:10012: {}
        route-target both 10012:10012: {}
        redistribute learned: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-33-3
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    router bgp 65101:
      vlan 21:
        rd 10.255.0.3:10021: {}
        route-target both 10021:10021: {}
        redistribute learned: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-33-4
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    router bgp 65101:
      vlan 22:
        rd 10.255.0.3:10022: {}
        route-target both 10022:10022: {}
        redistribute learned: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-33-5
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    router bgp 65101:
      vlan 3401:
        rd 10.255.0.3:13401: {}
        route-target both 13401:13401: {}
        redistribute learned: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-33-6
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    router bgp 65101:
      vlan 3402:
        rd 10.255.0.3:13402: {}
        route-target both 13402:13402: {}
        redistribute learned: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: BgpAddressFamily
metadata:
  name: dc1-leaf1a-34-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  asn: 65101
  addressFamily:
    afName: ipv4
    neighbors:
    - pgNameOrAddress: EVPN-OVERLAY-PEERS
      active: false
    - pgNameOrAddress: IPv4-UNDERLAY-PEERS
      active: true
    - pgNameOrAddress: MLAG-IPv4-UNDERLAY-PEER
      active: true
  crossplane:
    compositionRef:
      name: bgpaddressfamilys.eapi.eos.netclab.dev
---
apiVersion: eos.netclab.dev/v1alpha1
kind: BgpAddressFamily
metadata:
  name: dc1-leaf1a-34-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  asn: 65101
  addressFamily:
    afName: evpn
    neighbors:
    - pgNameOrAddress: EVPN-OVERLAY-PEERS
      active: true
  crossplane:
    compositionRef:
      name: bgpaddressfamilys.eapi.eos.netclab.dev
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-35-1
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    router bgp 65101:
      vrf VRF10:
        rd 10.255.0.3:10: {}
        route-target import evpn 10:10: {}
        route-target export evpn 10:10: {}
        router-id 10.255.0.3: {}
        neighbor 10.255.1.97 peer group MLAG-IPv4-UNDERLAY-PEER: {}
        neighbor 10.255.1.97 description dc1-leaf1b_Vlan3009: {}
        redistribute connected route-map RM-CONN-2-BGP-VRFS: {}
---
apiVersion: eos.netclab.dev/v1alpha1
kind: EosCommand
metadata:
  name: dc1-leaf1a-35-2
spec:
  endpoint: dc1-leaf1a.default.svc.cluster.local
  cmds:
    router bgp 65101:
      vrf VRF11:
        rd 10.255.0.3:11: {}
        route-target import evpn 11:11: {}
        route-target export evpn 11:11: {}
        router-id 10.255.0.3: {}
        neighbor 10.255.1.97 peer group MLAG-IPv4-UNDERLAY-PEER: {}
        neighbor 10.255.1.97 description dc1-leaf1b_Vlan3010: {}
        redistribute connected route-map RM-CONN-2-BGP-VRFS: {}
